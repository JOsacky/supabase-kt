# Supabase-kt Realtime

Extends Supabase-kt with a multiplatform Realtime client.

Newest version: [![Maven Central](https://img.shields.io/maven-central/v/io.github.jan-tennert.supabase/supabase-kt)](https://search.maven.org/search?q=g%3Aio.github.jan-tennert.supabase)

# Installation

```kotlin
dependencies {
    implementation("io.github.jan-tennert.supabase:realtime-kt:VERSION")
}
```

Install plugin in main supabase client. See [supabase-kt](https://github.com/supabase-community/supabase-kt) for more information
```kotlin
val client = createSupabaseClient {
    
    //...
    
    install(Realtime) {
        // settings
    }
    
}
```

# Features

<details><summary>Creating/Joining the channel</summary>

```kotlin
val channel = supabaseClient.realtime.createChannel("#random") {

    presence {
        //presence options
    }

    broadcast {
        //broadcast options
    }

}
channel.postgresChangeFlow<PostgresAction.Insert> {} // listen for changes
//listen for broadcasts ...

//in the end join the channel
channel.join()
```

</details>
<details><summary>Listening for database changes</summary>

```kotlin
val changeFlow: Flow<PostgresAction.Insert> = channel.postgresChangeFlow<PostgresAction.Insert>(schema = "public") {
    table = "test"
}
```

</details>
<details><summary>Broadcast API</summary>

```kotlin
val broadcastFlow: Flow<Position> = channel.broadcastFlow("position") //under the event "position"

channel.broadcast("position", Position(20, 30)) //broadcast your position to other clients (in the event "position")
```

</details>
<details><summary>Presence API</summary>

```kotlin
@Serializable
data class PresenceData(val userId: Int, val username: String)

channel.presenceFlow()
    .onEach {
        //joins and leaves are a map. The keys are either an id generated by realtime or a custom key which can be customized in the client builder. 
        otherUsers += it.decodeJoinsAs<PresenceData>()
        otherUsers -= it.decodeLeavesAs<PresenceData>()
    }
    .launchIn(SomeScope)
channel.join()
channel.track(PresenceData(2, "Example")) //send your "state"/presence to other clients
```

</details>